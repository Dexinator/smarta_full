---
// Layout principal para todas las páginas
// Audioguías Murales Santa Marta
import '../styles/global.css';

export interface Props {
  title: string;
  description?: string;
  lang?: string;
}

const {
  title,
  description = "Audioguías interactivas de los murales de Santa Marta. Descubre el arte urbano con audio accesible.",
  lang = "es"
} = Astro.props;
---

<!DOCTYPE html>
<html lang={lang} class="scroll-smooth">
<head>
  <!-- Script crítico para prevenir FOUC - debe ir antes de cualquier CSS -->
  <script is:inline>
    // Aplicar tema inmediatamente para prevenir flash
    (function() {
      const theme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

      if (theme === 'dark' || (!theme && prefersDark)) {
        document.documentElement.classList.add('dark');
      }

      // Aplicar configuraciones de accesibilidad inmediatamente
      const savedHighContrast = localStorage.getItem('high-contrast');
      if (savedHighContrast === 'true') {
        document.body.classList.add('high-contrast');
      }

      const savedFontSize = localStorage.getItem('font-size');
      if (savedFontSize) {
        document.documentElement.style.fontSize = `${savedFontSize}rem`;
      }
    })();
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{title}</title>
  <meta name="description" content={description}>

  <!-- SEO Meta Tags -->
  <meta name="keywords" content="audioguías, murales, Santa Marta, arte urbano, accesibilidad, turismo">
  <meta name="author" content="Audioguías Murales Santa Marta">
  <meta name="robots" content="index, follow">

  <!-- Open Graph -->
  <meta property="og:title" content={title}>
  <meta property="og:description" content={description}>
  <meta property="og:type" content="website">
  <meta property="og:locale" content={lang === "es" ? "es_ES" : "en_US"}>
  <meta property="og:image" content="/OPimg.jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="1200">
  <meta property="og:image:alt" content="Ruta de los Murales - Santa Marta de Tormes">

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">

  <!-- Preload critical fonts -->
  <link rel="preload" href="/fonts/Nunito-VariableFont_wght.ttf" as="font" type="font/ttf" crossorigin>
  <link rel="preload" href="/fonts/Nunito-Italic-VariableFont_wght.ttf" as="font" type="font/ttf" crossorigin>

  <!-- Accessibility -->
  <meta name="theme-color" content="#0072c0">
  <meta name="color-scheme" content="light dark">
</head>

<body class="font-sans bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 min-h-screen flex flex-col">
  <!-- Skip Link para accesibilidad -->
  <a href="#main-content" class="skip-link">
    {lang === "es" ? "Saltar al contenido principal" : "Skip to main content"}
  </a>

  <!-- Slot para el contenido (incluye Header) -->
  <slot />


  <!-- Scripts de accesibilidad y modo oscuro -->
  <script is:inline>
    // Declarar funciones globales INMEDIATAMENTE
    // Modo oscuro
    window.setLightMode = function() {
      document.documentElement.classList.remove('dark');
      localStorage.setItem('theme', 'light');
    };

    window.setDarkMode = function() {
      document.documentElement.classList.add('dark');
      localStorage.setItem('theme', 'dark');
    };

    window.toggleDarkMode = function() {
      const isDark = document.documentElement.classList.contains('dark');
      if (isDark) {
        window.setLightMode();
      } else {
        window.setDarkMode();
      }
    };

    // Alto contraste
    window.toggleHighContrast = function() {
      document.body.classList.toggle('high-contrast');
      const isHighContrast = document.body.classList.contains('high-contrast');
      localStorage.setItem('high-contrast', isHighContrast ? 'true' : 'false');
    };

    // Tamaño de fuente
    let currentFontSize = 1;
    window.adjustFontSize = function(delta) {
      currentFontSize = Math.max(0.8, Math.min(1.4, currentFontSize + (delta * 0.1)));
      document.documentElement.style.fontSize = currentFontSize + 'rem';
      localStorage.setItem('font-size', currentFontSize.toString());
    };

    // Inicializar configuraciones al cargar la página
    document.addEventListener('DOMContentLoaded', function() {
      // Restaurar tamaño de fuente guardado
      const savedFontSize = localStorage.getItem('font-size');
      if (savedFontSize) {
        currentFontSize = parseFloat(savedFontSize);
        document.documentElement.style.fontSize = currentFontSize + 'rem';
      }

      // Reducción de movimiento
      const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (prefersReducedMotion) {
        document.body.classList.add('reduce-motion');
      }
    });

    // Escuchar cambios en preferencias del sistema
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
      if (!localStorage.getItem('theme')) {
        if (e.matches) {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
      }
    });
  </script>
</body>
</html>